<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Survey Form | SJCB Household Profiling</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <style>
      .bg-church {
        background-color: #457507;
      }
      .btn-church {
        background-color: #457507;
        color: white;
      }
      .table-responsive {
        overflow-x: auto;
      }
      .table thead th {
        font-size: 0.75rem;
        white-space: nowrap;
        background-color: #f8f9fa;
        vertical-align: middle;
      }
      .form-control-sm,
      .form-select-sm {
        font-size: 0.8rem;
      }
      .instruction-text {
        font-size: 0.9rem;
        color: #666;
        font-style: italic;
      }

      @media (max-width: 768px) {
        .table {
          font-size: 0.7rem;
        }
        .form-control-sm,
        .form-select-sm {
          font-size: 0.75rem;
          padding: 0.25rem 0.5rem;
        }
      }
    </style>
  </head>

  <body class="d-flex flex-column min-vh-100">
    <nav class="navbar shadow-sm py-3 bg-church text-white">
      <div class="container-fluid px-4">
        <div class="d-flex align-items-center">
          <img
            src="/images/logo.jpg"
            width="40"
            height="40"
            class="rounded-circle me-2"
            alt="Logo"
          />
          <span class="fw-bold fs-4">Archdiocese of Tuguegarao</span>
        </div>
      </div>
    </nav>

    <main class="container-fluid px-4 my-4">
      <div class="progress mb-4" style="height: 25px">
        <div
          class="progress-bar bg-church"
          role="progressbar"
          style="width: 50%"
        >
          Step 2 of 4
        </div>
      </div>

      <form action="" method="POST">
        <div class="card shadow-sm mb-4">
          <div class="card-header fw-bold text-center bg-light">
            PRIMARY INFORMATION
          </div>
          <div class="card-body">
            <h6 class="fw-bold border-bottom pb-2">Parents Profile</h6>
            <div class="table-responsive mb-4">
              <table class="table table-bordered table-sm align-middle">
                <thead class="table-light text-center">
                  <tr>
                    <th style="width: 10%">Role</th>
                    <th>Full Name</th>
                    <th>Type of Marriage</th>
                    <th>Religion</th>
                    <th style="width: 80px">Sex</th>
                    <th style="width: 80px">Age</th>
                    <th>Highest Educ. Attainment</th>
                    <th>Occupation</th>
                    <th>Status of Work</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="fw-bold">HH Head:</td>
                    <td>
                      <input
                        type="text"
                        name="head_name"
                        class="form-control form-control-sm"
                        required
                      />
                    </td>
                    <td>
                      <input
                        type="text"
                        name="head_marriage"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <select
                        name="head_religion"
                        class="form-select form-select-sm"
                      >
                        <option value="1">1- Roman Catholic</option>
                        <option value="2">2- Islam</option>
                        <option value="99">99- Others</option>
                      </select>
                    </td>
                    <td>
                      <select
                        name="head_sex"
                        class="form-select form-select-sm"
                      >
                        <option value="1">1-M</option>
                        <option value="2">2-F</option>
                      </select>
                    </td>
                    <td>
                      <input
                        type="number"
                        name="head_age"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="text"
                        name="head_educ"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="text"
                        name="head_job"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <select
                        name="head_work_status"
                        class="form-select form-select-sm"
                      >
                        <option value="1">1- Regular</option>
                        <option value="2">2- Contractual</option>
                        <option value="3">3- Unemployed</option>
                      </select>
                    </td>
                  </tr>
                  <tr>
                    <td class="fw-bold">Spouse:</td>
                    <td>
                      <input
                        type="text"
                        name="spouse_name"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="text"
                        name="spouse_marriage"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <select
                        name="spouse_religion"
                        class="form-select form-select-sm"
                      >
                        <option value="1">1- Roman Catholic</option>
                        <option value="2">2- Islam</option>
                      </select>
                    </td>
                    <td>
                      <select
                        name="spouse_sex"
                        class="form-select form-select-sm"
                      >
                        <option value="2">2-F</option>
                        <option value="1">1-M</option>
                      </select>
                    </td>
                    <td>
                      <input
                        type="number"
                        name="spouse_age"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="text"
                        name="spouse_educ"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <input
                        type="text"
                        name="spouse_job"
                        class="form-control form-control-sm"
                      />
                    </td>
                    <td>
                      <select
                        name="spouse_work_status"
                        class="form-select form-select-sm"
                      >
                        <option value="1">1- Regular</option>
                        <option value="2">2- Contractual</option>
                      </select>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="d-flex justify-content-between align-items-end mb-2">
              <div>
                <h6 class="fw-bold mb-0">Name of Household Members</h6>
                <p class="instruction-text mb-0">
                  Order of listing: 
                  
                  <ul class="instruction-text">

                  <li>Never-Married Children of the Head/Spouse form the Oldest to the Youngest</li>
                  <li>Ever-Married Children of the
                  Head/Spouse form the Oldest to the Youngest</li>
                  <li>Other Relatives</li> 
                  <li>Nonrelatives</li>
                  </ul>
                </p>
              </div>
              <button
                type="button"
                class="btn btn-sm btn-church"
                onclick="addRow()"
              >
                <i class="bi bi-plus-circle"></i> Add Member
              </button>
            </div>

            <div class="table-responsive">
              <table
                class="table table-bordered table-sm text-center align-middle"
                id="membersTable"
              >
                <thead class="table-light">
                  <tr>
                    <th>Name</th>
                    <th>Relation</th>
                    <th>Sex</th>
                    <th>Age</th>
                    <th>Civil Status</th>
                    <th>Religion</th>
                    <th>Sacraments</th>
                    <th>Studying</th>
                    <th>Highest Educ.</th>
                    <th>Occupation</th>
                    <th>Status</th>
                    <th title="Only for children 0-5 years old">Immunized?</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="row justify-content-end gap-2 mb-5">
          <div class="col-auto">
            <button type="button" onclick="goPrev()" class="btn btn-secondary px-4">Previous</button>
          </div>
          <div class="col-auto">
            <button type="button" onclick="goNext()" class="btn btn-church px-4">
              Next
            </button>
          </div>
        </div>
        <input type="hidden" name="form_source" value="primary_info" />
      </form>
    </main>

    <footer class="bg-dark text-white mt-auto">
      <div class="container py-2">
        <div class="row align-items-center">
          <div class="col-md-9">
            <h6 class="fw-bold mb-0">Household Survey Profiling</h6>
            <p class="small mb-0" style="font-size: 0.75rem">SJCB BSIT-2 Project</p>
          </div>
          <div class="col-md-3 text-md-end">
            <small class="fw-bold d-block d-md-inline me-2">Follow Us:</small>
            <a href="https://www.facebook.com/sjcbiofficial" class="text-white me-2"><i class="bi bi-facebook"></i></a>
          </div>
        </div>
      </div>
      <div class="text-center py-1 bg-church" style="font-size: 0.8rem">
        Â© 2026 SJCB BSIT-2 | All Rights Reserved
      </div>
    </footer>

    <script>
      function addRow() {
        const table = document
          .getElementById("membersTable")
          .getElementsByTagName("tbody")[0];
        const newRow = table.insertRow();
        newRow.innerHTML = `
        <td><input name="m_name[]" class="form-control form-control-sm" required></td>
        <td>
          <select name="m_relation[]" class="form-select form-select-sm">
            <option value="1">1- Son</option><option value="2">2- Daughter</option><option value="3">3- Stepson</option>
            <option value="7">7- Grandson</option><option value="13">13- Relative</option><option value="99">99- Others</option>
          </select>
        </td>
        <td><select name="m_sex[]" class="form-select form-select-sm"><option value="1">1-M</option><option value="2">2-F</option></select></td>
        <td><input name="m_age[]" type="number" class="form-control form-control-sm" min="0"></td>
        <td>
          <select name="m_civil[]" class="form-select form-select-sm">
            <option value="1">1- Single</option><option value="2">2- Married</option>
            <option value="3">3- Common Law</option><option value="4">4- Widowed</option>
          </select>
        </td>
        <td>
          <select name="m_religion[]" class="form-select form-select-sm">
            <option value="1">1- Roman Catholic</option><option value="2">2- Islam</option><option value="99">99- Others</option>
          </select>
        </td>
        <td>
          <select name="m_sacraments[]" class="form-select form-select-sm">
            <option value="1">1- None</option><option value="2">2- Baptism</option><option value="3">3- Confirmation</option>
          </select>
        </td>
        <td><select name="m_studying[]" class="form-select form-select-sm"><option value="1">Yes</option><option value="2">No</option></select></td>
        <td><input name="m_educ[]" class="form-control form-control-sm"></td>
        <td><input name="m_job[]" class="form-control form-control-sm"></td>
        <td><select name="m_work_status[]" class="form-select form-select-sm"><option value="1">Reg</option><option value="2">Con</option></select></td>
        <td><select name="m_immunized[]" class="form-select form-select-sm"><option value="66">N/A</option><option value="1">Yes</option><option value="2">No</option></select></td>
        <td><button type="button" class="btn btn-sm btn-danger" onclick="this.closest('tr').remove()"><i class="bi bi-trash"></i></button></td>
      `;
      }

      function saveFormData() {
        const form = document.querySelector('form');
        const formData = new FormData(form);
        const data = {};
        for (let [key, value] of formData.entries()) {
          if (key.endsWith('[]')) {
            const arrKey = key.slice(0, -2);
            if (!data[arrKey]) data[arrKey] = [];
            data[arrKey].push(value);
          } else {
            data[key] = value;
          }
        }
        sessionStorage.setItem('survey_primary', JSON.stringify(data));
      }

      function loadSavedData() {
        const saved = JSON.parse(sessionStorage.getItem('survey_primary') || '{}');
        if (saved.head_name) document.querySelector('[name="head_name"]').value = saved.head_name;
        if (saved.head_marriage) document.querySelector('[name="head_marriage"]').value = saved.head_marriage;
        if (saved.head_religion) document.querySelector('[name="head_religion"]').value = saved.head_religion;
        if (saved.head_sex) document.querySelector('[name="head_sex"]').value = saved.head_sex;
        if (saved.head_age) document.querySelector('[name="head_age"]').value = saved.head_age;
        if (saved.head_educ) document.querySelector('[name="head_educ"]').value = saved.head_educ;
        if (saved.head_job) document.querySelector('[name="head_job"]').value = saved.head_job;
        if (saved.head_work_status) document.querySelector('[name="head_work_status"]').value = saved.head_work_status;
        if (saved.spouse_name) document.querySelector('[name="spouse_name"]').value = saved.spouse_name;
        if (saved.spouse_marriage) document.querySelector('[name="spouse_marriage"]').value = saved.spouse_marriage;
        if (saved.spouse_religion) document.querySelector('[name="spouse_religion"]').value = saved.spouse_religion;
        if (saved.spouse_sex) document.querySelector('[name="spouse_sex"]').value = saved.spouse_sex;
        if (saved.spouse_age) document.querySelector('[name="spouse_age"]').value = saved.spouse_age;
        if (saved.spouse_educ) document.querySelector('[name="spouse_educ"]').value = saved.spouse_educ;
        if (saved.spouse_job) document.querySelector('[name="spouse_job"]').value = saved.spouse_job;
        if (saved.spouse_work_status) document.querySelector('[name="spouse_work_status"]').value = saved.spouse_work_status;

        if (saved.m_name && Array.isArray(saved.m_name)) {
          const tbody = document.querySelector('#membersTable tbody');
          tbody.innerHTML = '';
          saved.m_name.forEach((name, idx) => {
            const table = document.getElementById('membersTable');
            const newRow = table.insertRow();
            newRow.innerHTML = `
            <td><input name="m_name[]" class="form-control form-control-sm" value="${name || ''}" required></td>
            <td>
              <select name="m_relation[]" class="form-select form-select-sm">
                <option value="1" ${saved.m_relation?.[idx] === '1' ? 'selected' : ''}>1- Son</option>
                <option value="2" ${saved.m_relation?.[idx] === '2' ? 'selected' : ''}>2- Daughter</option>
                <option value="3" ${saved.m_relation?.[idx] === '3' ? 'selected' : ''}>3- Stepson</option>
                <option value="7" ${saved.m_relation?.[idx] === '7' ? 'selected' : ''}>7- Grandson</option>
                <option value="13" ${saved.m_relation?.[idx] === '13' ? 'selected' : ''}>13- Relative</option>
                <option value="99" ${saved.m_relation?.[idx] === '99' ? 'selected' : ''}>99- Others</option>
              </select>
            </td>
            <td><select name="m_sex[]" class="form-select form-select-sm">
              <option value="1" ${saved.m_sex?.[idx] === '1' ? 'selected' : ''}>1-M</option>
              <option value="2" ${saved.m_sex?.[idx] === '2' ? 'selected' : ''}>2-F</option>
            </select></td>
            <td><input name="m_age[]" type="number" class="form-control form-control-sm" value="${saved.m_age?.[idx] || ''}"></td>
            <td>
              <select name="m_civil[]" class="form-select form-select-sm">
                <option value="1" ${saved.m_civil?.[idx] === '1' ? 'selected' : ''}>1- Single</option>
                <option value="2" ${saved.m_civil?.[idx] === '2' ? 'selected' : ''}>2- Married</option>
                <option value="3" ${saved.m_civil?.[idx] === '3' ? 'selected' : ''}>3- Common Law</option>
                <option value="4" ${saved.m_civil?.[idx] === '4' ? 'selected' : ''}>4- Widowed</option>
              </select>
            </td>
            <td>
              <select name="m_religion[]" class="form-select form-select-sm">
                <option value="1" ${saved.m_religion?.[idx] === '1' ? 'selected' : ''}>1- Roman Catholic</option>
                <option value="2" ${saved.m_religion?.[idx] === '2' ? 'selected' : ''}>2- Islam</option>
                <option value="99" ${saved.m_religion?.[idx] === '99' ? 'selected' : ''}>99- Others</option>
              </select>
            </td>
            <td>
              <select name="m_sacraments[]" class="form-select form-select-sm">
                <option value="1" ${saved.m_sacraments?.[idx] === '1' ? 'selected' : ''}>1- None</option>
                <option value="2" ${saved.m_sacraments?.[idx] === '2' ? 'selected' : ''}>2- Baptism</option>
                <option value="3" ${saved.m_sacraments?.[idx] === '3' ? 'selected' : ''}>3- Confirmation</option>
              </select>
            </td>
            <td><select name="m_studying[]" class="form-select form-select-sm">
              <option value="1" ${saved.m_studying?.[idx] === '1' ? 'selected' : ''}>Yes</option>
              <option value="2" ${saved.m_studying?.[idx] === '2' ? 'selected' : ''}>No</option>
            </select></td>
            <td><input name="m_educ[]" class="form-control form-control-sm" value="${saved.m_educ?.[idx] || ''}"></td>
            <td><input name="m_job[]" class="form-control form-control-sm" value="${saved.m_job?.[idx] || ''}"></td>
            <td><select name="m_work_status[]" class="form-select form-select-sm">
              <option value="1" ${saved.m_work_status?.[idx] === '1' ? 'selected' : ''}>Reg</option>
              <option value="2" ${saved.m_work_status?.[idx] === '2' ? 'selected' : ''}>Con</option>
            </select></td>
            <td><select name="m_immunized[]" class="form-select form-select-sm">
              <option value="66" ${saved.m_immunized?.[idx] === '66' ? 'selected' : ''}>N/A</option>
              <option value="1" ${saved.m_immunized?.[idx] === '1' ? 'selected' : ''}>Yes</option>
              <option value="2" ${saved.m_immunized?.[idx] === '2' ? 'selected' : ''}>No</option>
            </select></td>
            <td><button type="button" class="btn btn-sm btn-danger" onclick="this.closest('tr').remove()"><i class="bi bi-trash"></i></button></td>
          `;
          });
        } else {
          addRow();
        }
      }

      function goNext() {
        saveFormData();
        window.location.href = 'survey4.html';
      }

      function goPrev() {
        saveFormData();
        window.location.href = 'survey.html';
      }

      window.onload = function() {
        loadSavedData();
      };
    </script>
  </body>
</html>
